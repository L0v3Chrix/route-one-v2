---
import Layout from '../layouts/Layout.astro';
import SectionBridge from '../components/SectionBridge';
import AnimatedNumber from '../components/AnimatedNumber';
---

<Layout 
  title="Let's Talk — Route One Advisory"
  description="Book a 15-minute call with the Route One team. See what a managed finance department looks like for your business."
>
  <main class="min-h-dvh">
    
    <!-- Section: The Team -->
    <section class="px-6 py-8 md:py-12">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <p class="text-ro-green text-sm font-medium tracking-widest uppercase mb-4 fade-up">
            The Team
          </p>
          <h2 class="text-3xl sm:text-4xl font-medium text-ro-text-bright mb-4 fade-up fade-up-delay-1">
            Big Four rigor. Startup energy.<br />
            <span class="text-ro-gold">No assholes.</span>
          </h2>
          <p class="text-lg text-ro-text-dim max-w-2xl mx-auto fade-up fade-up-delay-2">
            We're selective about who we work with. Not because we're exclusive — because we want to do this right.
          </p>
        </div>
        
        <!-- Team Grid -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16">
          
          <!-- Mitch -->
          <div class="bg-ro-card border border-ro-card-border rounded-xl p-6 fade-up fade-up-delay-1">
            <div class="w-16 h-16 bg-ro-green/20 rounded-full flex items-center justify-center mb-4">
              <span class="text-2xl font-bold text-ro-green">MB</span>
            </div>
            <h3 class="text-xl font-semibold text-ro-text-bright">Mitch Bhatia</h3>
            <p class="text-ro-gold text-sm mb-3">Founder & Managing Partner</p>
            <p class="text-ro-text-dim text-sm">
              CPA. Firm strategy and client relationships. The one who makes sure things don't get stiff or corporate.
            </p>
          </div>
          
          <!-- Dean -->
          <div class="bg-ro-card border border-ro-card-border rounded-xl p-6 fade-up fade-up-delay-2">
            <div class="w-16 h-16 bg-ro-green/20 rounded-full flex items-center justify-center mb-4">
              <span class="text-2xl font-bold text-ro-green">DG</span>
            </div>
            <h3 class="text-xl font-semibold text-ro-text-bright">Dean Golder</h3>
            <p class="text-ro-gold text-sm mb-3">Partner, Strategic Finance</p>
            <p class="text-ro-text-dim text-sm">
              Led $150M capital raise. Supported $293M acquisition. The numbers guy who actually understands the story behind them.
            </p>
          </div>
          
          <!-- John -->
          <div class="bg-ro-card border border-ro-card-border rounded-xl p-6 fade-up fade-up-delay-3">
            <div class="w-16 h-16 bg-ro-green/20 rounded-full flex items-center justify-center mb-4">
              <span class="text-2xl font-bold text-ro-green">JD</span>
            </div>
            <h3 class="text-xl font-semibold text-ro-text-bright">John Dalton</h3>
            <p class="text-ro-gold text-sm mb-3">Director, CFO Advisory</p>
            <p class="text-ro-text-dim text-sm">
              PwC (9 years) + Deloitte (3 years). The operator who leads engagements. Big Four trained, small company friendly.
            </p>
          </div>
          
        </div>
        
        <!-- Credential Badges - Enhancement #3: Animated Numbers -->
        <div class="flex flex-wrap justify-center gap-4 mb-16 fade-up fade-up-delay-4">
          <div class="px-4 py-2 bg-ro-card border border-ro-card-border rounded-full text-sm text-ro-text-dim metric-glow">
            <AnimatedNumber client:visible value={300} prefix="$" suffix="M+" className="text-ro-gold font-semibold" /> in exits advised
          </div>
          <div class="px-4 py-2 bg-ro-card border border-ro-card-border rounded-full text-sm text-ro-text-dim metric-glow">
            <AnimatedNumber client:visible value={400} prefix="$" suffix="M+" className="text-ro-gold font-semibold" /> budgets managed
          </div>
          <div class="px-4 py-2 bg-ro-card border border-ro-card-border rounded-full text-sm text-ro-text-dim metric-glow">
            <AnimatedNumber client:visible value={175} prefix="$" suffix="M+" className="text-ro-gold font-semibold" /> capital raised
          </div>
        </div>
      </div>
    </section>

    <!-- Bridge 3: Talk -->
    <section class="px-6 fade-up">
      <div class="max-w-4xl mx-auto">
        <SectionBridge 
          client:visible
          prompt="What would you do with that time back?"
          options={[
            { label: 'Focus on deals', value: 'focus-deals' },
            { label: 'Actually take a vacation', value: 'vacation' },
            { label: 'Grow the business', value: 'grow-business' },
          ]}
          followUp={{
            'focus-deals': "That's where you should be.",
            'vacation': "You've earned it.",
            'grow-business': "Hard to do when you're closing the books.",
          }}
          storageKey="talk"
        />
      </div>
    </section>
    
    <!-- Section: CTA -->
    <section class="px-6 py-8 md:py-12">
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-3xl sm:text-4xl font-medium text-ro-text-bright mb-4 fade-up">
          You've seen the diagnostic. You've seen the proof. There's one step left.
        </h2>
        <p class="text-lg text-ro-text-dim mb-8 fade-up fade-up-delay-1">
          15 minutes with the team above. We'll show you what Route One looks like for your business.
        </p>
        
        <!-- Proof-Near-CTA - Enhancement #12 -->
        <div class="flex flex-wrap justify-center gap-3 mb-8 fade-up fade-up-delay-2">
          <div class="px-3 py-1.5 bg-ro-green/10 border border-ro-green/30 rounded-full text-xs text-ro-text-dim">
            <span class="text-ro-green font-medium">44</span> client engagements
          </div>
          <div class="px-3 py-1.5 bg-ro-green/10 border border-ro-green/30 rounded-full text-xs text-ro-text-dim">
            <span class="text-ro-green font-medium">100%</span> retention
          </div>
          <div class="px-3 py-1.5 bg-ro-green/10 border border-ro-green/30 rounded-full text-xs text-ro-text-dim">
            Avg <span class="text-ro-green font-medium">60 days</span> to current
          </div>
        </div>
        
        <!-- Calendar Embed -->
        <div class="bg-ro-card border border-ro-card-border rounded-xl p-8 mb-8 fade-up fade-up-delay-2">
          <p class="text-ro-text-dim mb-4">Book a time that works for you:</p>
          
          <!-- Configurable calendar embed: Set data-calendar-url to embed calendar, leave empty for mailto fallback -->
          <div id="calendar-embed" class="bg-ro-darker rounded-lg overflow-hidden" style="min-height: 500px;">
            <div data-calendar-url="" id="calendar-container" class="p-8 text-center">
              <!-- Mailto fallback (shown when no calendar URL is set) -->
              <div id="calendar-fallback">
                <p class="text-ro-text-dim mb-4">Ready to talk?</p>
                <a 
                  href="mailto:mitch@routeoneadvisory.com?subject=Route%20One%20Diagnostic%20Call&body=I%20just%20went%20through%20your%20funnel%20and%20would%20like%20to%20schedule%20a%20diagnostic%20call."
                  class="inline-flex items-center justify-center bg-ro-green hover:bg-ro-green-light text-white font-semibold px-6 py-3 rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-ro-gold focus-visible:ring-offset-2 focus-visible:ring-offset-ro-dark min-h-[48px]"
                >
                  Email to Schedule →
                </a>
              </div>
            </div>
          </div>
          
          <!-- WhatsApp CTA -->
          <div class="text-center mt-6">
            <p class="text-ro-text-dim text-sm mb-2">Prefer a quick message?</p>
            <a id="whatsapp-cta" href="#" target="_blank"
               class="text-ro-green hover:text-ro-green-light transition-colors text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-ro-gold">
              Message us on WhatsApp →
            </a>
          </div>
        </div>
        
        <!-- Not Ready -->
        <div class="fade-up fade-up-delay-3">
          <a 
            href="/not-ready"
            class="text-ro-text-dim hover:text-ro-gold transition-colors text-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-ro-gold"
          >
            Not ready yet? That's okay →
          </a>
        </div>
      </div>
    </section>
    
  </main>
  
  <script>
    import { getStoredSession, isSessionExpired, clearSession } from '../lib/session';
    
    // Calendar embed: if data-calendar-url is set, replace fallback with iframe
    const container = document.getElementById('calendar-container');
    const fallback = document.getElementById('calendar-fallback');
    const url = container?.getAttribute('data-calendar-url');
    
    if (url && url.trim() !== '') {
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.style.cssText = 'width:100%;height:500px;border:none;';
      iframe.loading = 'lazy';
      iframe.title = 'Schedule a call with Route One Advisory';
      if (fallback) fallback.remove();
      container?.appendChild(iframe);
    }
    
    // Session expiry check
    const session = getStoredSession();
    if (session?.savedAt && isSessionExpired(session.savedAt)) {
      clearSession();
    }
    
    // WhatsApp CTA: pre-populate message from localStorage quiz data
    const waLink = document.getElementById('whatsapp-cta') as HTMLAnchorElement | null;
    if (waLink) {
      try {
        const stored = session;
        const state = stored?.state;
        let msgParts = ['I just went through the Route One diagnostic.'];
        
        if (state?.contact?.firstName) {
          msgParts = [`Hi, I'm ${state.contact.firstName}. I just went through the Route One diagnostic.`];
        }
        
        if (state?.answers) {
          msgParts.push('(Diagnostic completed)');
        }
        
        if (state?.contact?.company) {
          msgParts.push(`Company: ${state.contact.company}`);
        }
        
        msgParts.push("I'd like to talk.");
        
        const msg = encodeURIComponent(msgParts.join(' '));
        waLink.href = `https://wa.me/?text=${msg}`;
        // TODO: Add Route One WhatsApp number when provided (format: https://wa.me/1234567890?text=...)
      } catch {
        waLink.href = `https://wa.me/?text=${encodeURIComponent("I just went through the Route One diagnostic. I'd like to talk.")}`;
      }
    }
  </script>
</Layout>
