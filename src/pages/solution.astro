---
import Layout from '../layouts/Layout.astro';
import DynamicSolution from '../components/DynamicSolution';

// Try to get industry from URL params (for direct links) or default to 'other'
const url = new URL(Astro.request.url);
const industry = url.searchParams.get('industry') || 'other';
---

<Layout title="The Route One Model â€” Route One Advisory">
  <main>
    <DynamicSolution client:load industry={industry} />
  </main>
</Layout>

<script>
  // On page load, check localStorage for industry if not in URL
  const urlParams = new URLSearchParams(window.location.search);
  if (!urlParams.has('industry')) {
    try {
      const stored = localStorage.getItem('ro_quiz_v2');
      if (stored) {
        const data = JSON.parse(stored);
        const industry = data?.state?.answers?.industry;
        if (industry && industry !== 'other') {
          // Redirect with industry param for consistent experience
          const newUrl = new URL(window.location.href);
          newUrl.searchParams.set('industry', industry);
          window.history.replaceState({}, '', newUrl.toString());
          // Trigger a re-render by dispatching a custom event
          window.dispatchEvent(new CustomEvent('industryLoaded', { detail: industry }));
        }
      }
    } catch (e) {
      // Ignore localStorage errors
    }
  }
</script>
